function getCurrentTab(t){chrome.tabs.query({currentWindow:!0,active:!0,windowType:"normal"},function(e){t(e[0])})}chrome.tabs.onUpdated.addListener((t,e)=>{void 0!==e.status&&"complete"===e.status&&chrome.tabs.executeScript(t,{file:"js/content.js",allFrames:!1},()=>{chrome.runtime.lastError})}),void 0===localStorage.soundvolume&&(localStorage.soundvolume=1);var tabs=new Array,auto_start_url=localStorage.asurl;if("true"==localStorage.autostart&&auto_start_url){var default_time=5e3;localStorage.default_time&&(default_time=1e3*localStorage.default_time),loop_start(-1,default_time,"C","","",auto_start_url)}chrome.extension.onConnect.addListener(function(t){"getOptions"===t.name&&t.onMessage.addListener(function(e){"getAllOptions"===e.msg&&getCurrentTab(function(e){(tabs[e.id]||!1)&&t.postMessage({status:tabs[e.id].status,time_interval:tabs[e.id].interval_time,time_type:tabs[e.id].time_type,checkme:tabs[e.id].checkme,wait_time:tabs[e.id].wait_time})})})});var RELOAD_LIMIT=10,counters={},pending_reloads={},blank_page=chrome.extension.getURL("blank.html");function updateTab(t,e){try{counters[t]=counters[t]||0,counters[t]+=1,chrome.tabs.update(t,{url:e})}catch(t){alert(t)}}function updateTabWithBlankSandwich(t,e){chrome.tabs.update(t,{url:blank_page})}function real_start(t,e){stopBadgeTimer(t),tabs[t].status="start",chrome.tabs.onUpdated.addListener(onUpdateListener),reload_it(t,e)}function get_rand_time(t,e){return Math.round(Math.random()*(e-t-0))+(t-0)}function loop_start(t,e,a,o,n,i){getCurrentTab(function(s){var r=s.id;if(chrome.tabs.sendMessage(r,{pattern:"C"},null),tabs[r]&&reload_cancel(s.id,"no"),tabs[r]=new Array,i?(tabs[r].pre_url=i,tabs[r].action_url=i):tabs[r].action_url=s.url,tabs[r].interval_time=e,"rand"==a){var l=e.split("-"),d=get_rand_time(l[0],l[1]);tabs[r].time_between_load=1e3*d}else tabs[r].time_between_load=e;tabs[r].time_type=a,tabs[r].next_round=tabs[r].time_between_load/1e3,o&&(tabs[r].checkme=o),n&&(tabs[r].pmpattern=n),tabs[r].count=0;var c=tabs[r].action_url;if(-1==t)tabs[r].status="start",tabs[r].wait_time=0,tabs[r].wait_next_round=0,tabs[r].displayTimer&&stopBadgeTimer(r),real_start(r,c);else{tabs[r].wait_time=t;var u=0;t.toString().search(" ")>0?(tabs[r].status="wait",u=new Date(t).getTime()-(new Date).getTime(),tabs[r].wait_next_round=Math.floor(u/1e3)):(tabs[r].status="wait",u=t,tabs[r].wait_next_round=t/1e3),tabs[r].displayTimer=window.setInterval(function(t){tabs[t].wait_next_round--,setTimerBadgeText(t)},1e3,r),setTimeout(function(){real_start(r,c)},u)}})}function loop_stop(){getCurrentTab(function(t){chrome.tabs.sendMessage(t.id,{pattern:"D"},null),reload_cancel(t.id,"no")})}function onUpdateListener(t,e,a){if(a.url!=blank_page&&(chrome.browserAction.setBadgeText({text:"",tabId:t}),tabs[t]&&"start"==tabs[t].status&&tabs[t].time_between_load>0||!1))if("loading"===e.status){var o=e.url||!1;tabs[t].pre_url?tabs[t].action_url=tabs[t].pre_url:o&&(tabs[t].action_url=o)}else if("complete"===e.status){if("rand"==tabs[t].time_type){var n=tabs[t].interval_time.split("-"),i=get_rand_time(n[0],n[1]);tabs[t].time_between_load=1e3*i}tabs[t].next_round=tabs[t].time_between_load/1e3,setTheBadgeText(t),setupReloadTimer(t),stopBadgeTimer(t),tabs[t].displayTimer=window.setInterval(function(t){tabs[t].next_round--,setTheBadgeText(t)},1e3,t)}}function setupReloadTimer(t){tabs[t].reloadTimer&&(clearTimeout(tabs[t].reloadTimer),tabs[t].reloadTimer=null),tabs[t].reloadTimer=window.setTimeout(function(t){reload_it(t,tabs[t].action_url)},tabs[t].time_between_load,t)}function stopBadgeTimer(t){tabs[t].displayTimer&&(clearTimeout(tabs[t].displayTimer),tabs[t].displayTimer=null)}function setTimerBadgeText(t){chrome.browserAction.setBadgeBackgroundColor({color:[0,128,0,255],tabId:t});var e=String(tabs[t].wait_next_round),a=tabs[t].wait_next_round%60,o=Math.floor(tabs[t].wait_next_round/60%60),n=Math.floor(tabs[t].wait_next_round/3600%24),i=Math.floor(tabs[t].wait_next_round/86400);if(i>999)e="9...";else if(i>9)e=String(i)+"d";else if(i>0)e=String(i)+"d"+String(n)+"h";else if(n>0){if(o<10&&(o="0"+String(o)),a%2)var s=":";else s=" ";e=String(n)+s+String(o)}else a<10&&(a="0"+String(a)),e=String(o)+":"+String(a);chrome.browserAction.setBadgeText({text:e,tabId:t})}function setTheBadgeText(t){if(tabs[t].next_round<0)chrome.browserAction.setBadgeText({text:String(),tabId:t}),stopBadgeTimer(t);else{var e=String(tabs[t].next_round),a=tabs[t].next_round%60,o=Math.floor(tabs[t].next_round/60%60),n=Math.floor(tabs[t].next_round/3600%24),i=Math.floor(tabs[t].next_round/86400);if(i>999)e="9...";else if(i>9)e=String(i)+"d";else if(i>0)e=String(i)+"d"+String(n)+"h";else if(n>0){if(o<10&&(o="0"+String(o)),a%2)var s=":";else s=" ";e=String(n)+s+String(o)}else a<10&&(a="0"+String(a)),e=String(o)+":"+String(a);chrome.browserAction.setBadgeText({text:e,tabId:t})}}chrome.tabs.onUpdated.addListener(function(t,e,a){e.url==blank_page&&pending_reloads[t]&&"loading"==e.status&&delete pending_reloads[t]});var onClickForNotifications={},onCloseForNotifications={};function fireNotificationClick(t){onClickForNotifications[t]&&onClickForNotifications[t]()}function fireNotificationClose(t){onCloseForNotifications[t]&&onCloseForNotifications[t]()}function show_notification(t,e,a){var o="B"==t?"Lost":"Found",n=/(..):(..)/.exec(new Date),i=(n[1],n[1],{type:"basic",title:o+" the target text! - ARP",message:'"'+e+'"',iconUrl:"Icon/icon-80.png",contextMessage:"Click on this box to see the tab.",buttons:[{title:"Show tab"},{title:"Dismiss"}],isClickable:!0}),s=new Notification(i.title,{body:"\n"+i.message+"\n\n"+i.contextMessage,icon:"Icon/icon-128.png"});s.onclick=function(){a&&a(),l()},s.onclose=l;var r="";function l(){pause_sound_with_fadeout(d)}localStorage.sound&&"2"==localStorage.sound?r="./sound/sound1.mp3":localStorage.sound&&"3"==localStorage.sound?r="./sound/sound2.mp3":localStorage.sound&&"4"==localStorage.sound&&(r=localStorage.soundurl?localStorage.soundurl:"./sound/sound1.mp3");var d=document.getElementById("sound_elem");r&&(d.src=r,d.loop="sound"!=localStorage.pm_sound_til,d.play(),d.volume=localStorage.soundvolume,"timeout"==localStorage.pm_sound_til&&setTimeout(l,1e3*localStorage.pm_sound_timeout||5e3))}function pause_sound_with_fadeout(t){if(t){var e=t.volume;volume_fadeout_timer=setInterval(function(){e>0?(e-=.05,t.volume=Math.max(e,0)):(clearInterval(volume_fadeout_timer),t.pause())},16)}}function reload_it(t,e){if(tabs[t].checkme){var a=tabs[t].checkme,o=tabs[t].pmpattern;0==tabs[t].count?updateTab(t,e):chrome.tabs.sendMessage(t,{checkme:a,pattern:o},function(n){"yes"==n.findresult?(reload_cancel(t,"yes"),chrome.tabs.get(t,function(e){chrome.windows.getLastFocused({},function(n){n.id==e.windowId&&n.focused||(chrome.windows.update(e.windowId,{drawAttention:!0}),chrome.tabs.update(t,{active:!0})),show_notification(o,a,function(){chrome.tabs.update(t,{active:!0}),chrome.windows.update(e.windowId,{focused:!0})})})})):(chrome.browserAction.setBadgeText({text:"",tabId:t}),updateTab(t,e))})}else chrome.browserAction.setBadgeText({text:"",tabId:t}),updateTab(t,e);tabs[t].count++}function reload_cancel(t,e){tabs[t].reloadTimer&&(clearTimeout(tabs[t].reloadTimer),tabs[t].reloadTimer=null),tabs[t].displayTimer&&(clearTimeout(tabs[t].displayTimer),tabs[t].displayTimer=null),tabs[t].status="stop",tabs[t].next_round=0,"yes"==e?chrome.browserAction.setBadgeText({text:"YES",tabId:t}):chrome.browserAction.setBadgeText({text:"",tabId:t})}chrome.notifications.onClicked.addListener(function(t){fireNotificationClick(t)}),chrome.notifications.onButtonClicked.addListener(function(t,e){0==e?fireNotificationClick(t):1==e&&fireNotificationClose(t)}),chrome.notifications.onClosed.addListener(function(t){fireNotificationClose(t),delete onCloseForNotifications[t],delete onClickForNotifications[t]}),chrome.runtime.onInstalled.addListener(function(t){});